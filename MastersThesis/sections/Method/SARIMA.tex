% TODO: Add reference to the goals pressented in the introduction, and evaluate if the experiments here is used to ansewer some of the research questions 

\section{SARIMA baseline}
\label{section:Method:SARIMA}

The SARIMA model is the first model to create baseline metrics for comparisons with other models.
The SARIMA model is limited to being a local and univariate method,
thus limiting the number of experiments that can be run.

Due to the inherent seasonal component present in the e-commerce data available in this paper,
the seasonal SARIMA model is selected in favor of the non-seasonal ARIMA model.

\subsubsection{SARIMA Tuning}
Model tuning of the SARIMA model is done with the auto-arima framework.
Auto-arima utilizes Bayesian optimization to find a well-suited set of hyperparameters to use,
within a defined search space for parameters.
Using the MAE metric as a measure of performance, auto-arima search for a set of parameters for each individual time-series
in the datasets defined in \cref{section:Data:Dataset}.
The parameter search space used during the tuning is defined in \cref{table:method:arima-tuning} with the range of parameter values.

\begin{table}[h]
  \centering
  \caption{Parameter search space auto-arima, SARIMA tuning}
  \label{table:method:arima-tuning}
  \begin{tabular}{|c|l|l|}\hline
    Parameter & Min & Max \\ \hline
    p         & 0   & 7   \\ \hline
    q         & 0   & 7   \\ \hline
    d         & 0   & 7   \\ \hline
    P         & 0   & 5   \\ \hline
    Q         & 0   & 5   \\ \hline
    D         & 0   & 5   \\ \hline
    S         & 12   & 12   \\ \hline
  \end{tabular}
\end{table}









\iffalse
% --------------------------------------------
% __ Contents __
% What model is used?
% What dataset is used? (Is there a split?)
% Error metrics used and recorded?
% Tuning method used
% Experiments run after tuning
% Expectations from experiments
% Add which resarch questions this answers or helps to answer
% --------------------------------------------



% Model
The first experiments conducted are done in order to create a SARIMA baseline.
The SARIMA model is used to make multi step predictions that is going to be used as reference for other models.

% Dataset
Using the datasets defined in \cref{section:Data:Dataset} SARIMA models are created.
A model with a connected set of hyperparameters are selected for each of the time-series in the 3 datasets used in this paper.
Due to the inheret seasonality in the e-commerce data, as explored in \cref{section:Data:DataAnalysis},
the SARIMA model is selected due to the seasonal component.
It is the addition of this seasonal component that warrents the use of the SARIMA model over the simpler ARIMA model.

% Error metrics
In order to measure the accuracy of the models predictions multiple error metrics are utilized.
Primarily, the measure of MASE is used in order to measure accuracy.
As pressented in \cref{section:BT:Loss}, the MASE metric is used to measure the predictive accuracy
compared to a naive forecast.
However, during tuning of the models the MAE error metric is used, as this is the basis for the MAPE metrics we wish to use as a measure.
Additionaly, error metrics such as MSE, SMAPE, and MAPE is used to measure accuracy of the completed models.

% Tuning
\subsection{Tuning Arima}
Model tuning of the SARIMA model is done with the auto-arima framework.
Auto-arima utilize bayesian optimization to find a well suited set of hyperparameters to use,
within a defined search space for parameters.
Using the MAE metric as a measure of performance, auto arima search for a set of parameters for each individual time-series
in the datasets defined in \cref{section:Data:Dataset}.
The parmeter search space used during the tuning is defined in \cref{table:method:arima-tuning} with the range of parameter value.

\begin{table}[h]
  \centering
  \caption{Parameter search space auto-arima, SARIMA tuning}
  \label{table:method:arima-tuning}
  \begin{tabular}{|c|l|l|}\hline
    Parameter & Min & Max \\ \hline
    p         & 0   & 7   \\ \hline
    q         & 0   & 7   \\ \hline
    d         & 0   & 7   \\ \hline
    P         & 0   & 5   \\ \hline
    Q         & 0   & 5   \\ \hline
    D         & 0   & 5   \\ \hline
    S         & 12   & 12   \\ \hline
  \end{tabular}
\end{table}


\subsection{Models}

After tuning of each model, the recorded hyperparameters are used to create predictive models for each time-series.
The models are then trained on the available training data, resulting in a trained model.
Each model is then used in order to make a 7 day prediction forward in time.
This 7 day prediciton is then compared to the 7 day ahead test-set used to measure the true predictive ability of the trained models.
These predictions are then used in order to measure the predictive error using the defined error metrics above.



\fi


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%% OLD VERSION %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\iffalse
  The SARIMA model is a univariate method only supporting predictions made on individual time-series.
  A model is created for each of the time-series in the datasets defined in \cref{section:Data:Dataset}.
  The model is created with the intension of creating 7 day predictions.
  Predictive accuracy is therefor measured based on the models 7 day predictions.

  Experiments with the ARIMA model is done on each time-series in the datasets introduced in \cref{section:Data:Dataset}.
  A number of experiments are therefor ran on each time-series in both \textit{dataset 1} and \textit{dataset 2}.


  \iffalse
    ARIMA models are first tuned on each time-series in order to make predicitons.
    The hyper-parmeters fond after the tuning is then used in order to created models capable of making predictions.
    The model attempts to make a 7 day ahead prediction.
    % TODO: Add more about the 7 day prediction?
  \fi

  \subsection{Tuning of parameters}
  Hyper-parmeter tuning for ARIMA is done in two different ways.
  The first one is through the parameter search method \textit{Grid search},
  while the secound approach used \textit{Bayesian optimization} with the \textit{auto\_arima} framework.

  \subsubsection*{Grid search}
  Using the parameter tuning method of grid search, a well suited ARIMA model is searched for.
  Grid search is an excessive search method where each parameter compoison is tested.
  Each set of parameters are  used to define a model, training it using the training dataset,
  and then validating it agains the validation set.
  With the goal of making a 7 day prediction, a 7 day forecast is compared to the validation data,
  so that the 7 day prediction error is measured.
  The model with the best 7 day prediction resulting in the lowest validation error,
  is then selected as the best model found after parameter tuning.
  Prediction error is measured in each of the loss functions \textit{MAE, MSE, MASE and SMAPE}.

  \subsubsection{Auto ARIMA}
  The secound method used for parameter tuning is the Auto ARIMA method from the \textit{pmdarima} python library.
  %% TODO: Add "pmdarima" reference
  This method utilizes Bayesian optimization for search in the search space for hyper parameters.
  Evaluating models using cross-validation and error metrics such as the "mse",
  the auto\_arima method find a well suited hyper parameter set in a fraction of the time used by the exchaustive grid search.

  \subsection{Trained models}
  When the models are tuned through Grid search and auto\_arima,
  the searched hyper parameters are applied to models in order to run predictions.
  While the tuning trains the ARIMA model on the training data, while validating it on the validation data,
  it still runs the risk of overfitting the model.
  The tuning may select a model with such a high complexity that while it fits the validation data well,
  but do not generalize enough to be usable on a unseen test set.
  The tuned models are therefor trained using both the training data and validation data for training,
  before it is used to predict the next 7 values coinsiding with the test set.
  The predictive capability of the resuling models serve as a benchmark for actual prediction
  of unknown data as it is not possible to tune models on data which have not yet been recorded.
  Therefor, this is the true measure of the predictive capability of the ARIMA model.


  \subsection{Expected results}

  Using the ARIMA model for creating a 7 day multi step ahead prediction is not expected to yeald wery good results.
  The ARIMA model has problems with data where there is a high volatility in the data, with a high standard variation.
  The data available, as described in \cref{section:Data:DataAnalysis},
  is highly volatile and thus makes the predictions more dificult for the ARIMA model.

  We expect the model to show the underlying trends in the dataset, but to
  undershoot its predictions.
  It is also expected that the ARIMA model is going to have a larger problem with making predictions on data with a high seasonality.
  Because of this, the SARIMA model will also serve as a baseline.


  \section{Experiment 2 - SARIMA baselin}
  \label{section:Method:Experiment2}

  The secound experiment conducted is done with the SARIMA model.
  Just like the ARIMA model from experiment 1, the SARIMA model is used on the datasets defined in \cref{section:Data:Dataset}.
  Experiment 2 shares the same method for tuning of the model as in experiment 1,
  as well as using the same method for evaluating the tuned models.
  Se experiment 1 for reference \cref{section:Method:Experiment1}.

  \subsection{Expected results}
  As with the ARIMA model, the SARIMA is not expected to yeald great results either as it suffers from the same problems as the ARIMA model.
  However, the SARIMA model is expected to be an improvement to the ARIMA model for data with a high seasonality.

  With the available data, seasonality differ from dataset to dataset. While some time-series have a high seasonal component,
  others have little to no seasonality.
  The SARIMA model is therefor only expected to outperform the ARIMA model on time-series with seasonality.

\fi